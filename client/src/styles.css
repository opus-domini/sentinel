@import 'tailwindcss';
@import '@fontsource-variable/jetbrains-mono';
@import '@xterm/xterm/css/xterm.css';

@custom-variant dark (&:is(.dark *));

:root {
  color-scheme: dark;

  /* Mobile viewport tracking */
  --keyboard-inset: 0px;
  --viewport-offset-top: 0px;
  --viewport-offset-left: 0px;
  --visual-viewport-height: 100dvh;
  --visual-viewport-width: 100vw;

  /* shadcn standard tokens â€” dark-only theme */
  --background: #0a0a0a;
  --foreground: #e6e6e6;
  --card: #111111;
  --card-foreground: #e6e6e6;
  --popover: #111111;
  --popover-foreground: #e6e6e6;
  --primary: #3b82f6;
  --primary-foreground: #ffffff;
  --secondary: #171717;
  --secondary-foreground: #a7a7a7;
  --muted: #171717;
  --muted-foreground: #787878;
  --accent: #232323;
  --accent-foreground: #e6e6e6;
  --destructive: #f87171;
  --border: #2a2a2a;
  --input: #2a2a2a;
  --ring: #3b82f6;
  --radius: 0.375rem;

  /* Sentinel-specific tokens */
  --border-subtle: #202020;
  --ok: #22c55e;
  --warning: #eab308;

  /* Surfaces (dark grays) */
  --surface-inset: #0b0b0b;
  --surface-sunken: #0d0d0d;
  --surface-raised: #0f0f0f;
  --surface-overlay: #101010;
  --surface-elevated: #121212;
  --surface-hover: #151515;
  --surface-active: #1d1d1d;
  --surface-active-primary: #161b27;
  --surface-close-hover: #1b1b1b;

  /* Primary text (blue tints) */
  --primary-text: #bfd8ff;
  --primary-text-bright: #c9deff;
  --primary-text-light: #d9e6ff;
  --primary-text-lightest: #e9f1ff;

  /* Status foreground */
  --ok-foreground: #8ef1b2;
  --warning-foreground: #f3d36f;
  --destructive-foreground: #ffc0c0;

  /* Misc */
  --inactive-dot: #656565;
  --disconnected-text: #cccccc;
  --link: #8ab4ff;

  /* Create button gradient */
  --create-border: #2b64da;
  --create-from: #1a3a6e;
  --create-to: #122a52;
  --create-hover-from: #1f4580;
  --create-hover-to: #163460;

  /* Brand logo gradient */
  --brand-from: #1f2f56;
  --brand-to: #16233e;
}

@theme inline {
  --font-mono:
    'JetBrains Mono Variable', 'JetBrains Mono', 'SF Mono', monospace;

  /* shadcn standard */
  --color-background: var(--background);
  --color-foreground: var(--foreground);
  --color-card: var(--card);
  --color-card-foreground: var(--card-foreground);
  --color-popover: var(--popover);
  --color-popover-foreground: var(--popover-foreground);
  --color-primary: var(--primary);
  --color-primary-foreground: var(--primary-foreground);
  --color-secondary: var(--secondary);
  --color-secondary-foreground: var(--secondary-foreground);
  --color-muted: var(--muted);
  --color-muted-foreground: var(--muted-foreground);
  --color-accent: var(--accent);
  --color-accent-foreground: var(--accent-foreground);
  --color-destructive: var(--destructive);
  --color-border: var(--border);
  --color-input: var(--input);
  --color-ring: var(--ring);
  --radius-sm: calc(var(--radius) - 2px);
  --radius-md: var(--radius);
  --radius-lg: calc(var(--radius) + 2px);
  --radius-xl: calc(var(--radius) + 6px);

  /* Sentinel-specific */
  --color-border-subtle: var(--border-subtle);
  --color-ok: var(--ok);
  --color-warning: var(--warning);

  /* Surfaces */
  --color-surface-inset: var(--surface-inset);
  --color-surface-sunken: var(--surface-sunken);
  --color-surface-raised: var(--surface-raised);
  --color-surface-overlay: var(--surface-overlay);
  --color-surface-elevated: var(--surface-elevated);
  --color-surface-hover: var(--surface-hover);
  --color-surface-active: var(--surface-active);
  --color-surface-active-primary: var(--surface-active-primary);
  --color-surface-close-hover: var(--surface-close-hover);

  /* Primary text tints */
  --color-primary-text: var(--primary-text);
  --color-primary-text-bright: var(--primary-text-bright);
  --color-primary-text-light: var(--primary-text-light);
  --color-primary-text-lightest: var(--primary-text-lightest);

  /* Status foreground */
  --color-ok-foreground: var(--ok-foreground);
  --color-warning-foreground: var(--warning-foreground);
  --color-destructive-foreground: var(--destructive-foreground);

  /* Misc */
  --color-inactive-dot: var(--inactive-dot);
  --color-disconnected-text: var(--disconnected-text);
  --color-link: var(--link);
}

@layer base {
  html,
  body {
    height: 100dvh;
    overflow: hidden;
  }

  #root {
    height: 100dvh;
    display: flex;
    flex-direction: column;
  }

  * {
    @apply border-border outline-ring/50;
  }

  body {
    @apply m-0 bg-background font-mono text-[13px] text-foreground antialiased;
  }
}

@layer components {
  .landing-body {
    @apply grid min-h-screen place-items-center;
    background:
      radial-gradient(
        circle at 10% 10%,
        rgba(37, 99, 235, 0.22),
        transparent 45%
      ),
      radial-gradient(
        circle at 90% 0%,
        rgba(30, 64, 175, 0.16),
        transparent 40%
      ),
      var(--background);
  }

  .landing-card {
    @apply w-[min(760px,92vw)] rounded-xl border border-border bg-card p-6;
    background-image: linear-gradient(
      180deg,
      rgba(23, 23, 23, 0.95),
      rgba(14, 14, 14, 0.95)
    );
  }

  .landing-card h1 {
    @apply m-0 text-[28px] font-bold uppercase tracking-[0.08em];
  }

  .landing-card p {
    @apply mb-0 mt-2 text-secondary-foreground;
  }

  .landing-meta {
    @apply my-4 grid gap-2;
  }

  .pill {
    @apply inline-flex h-6 w-fit items-center rounded-full border border-border bg-secondary px-2.5 text-secondary-foreground;
  }

  .landing-card a {
    @apply text-link no-underline hover:underline;
  }

  .btn-create {
    border-color: var(--create-border);
    background: linear-gradient(
      to bottom,
      var(--create-from),
      var(--create-to)
    );
    &:hover {
      background: linear-gradient(
        to bottom,
        var(--create-hover-from),
        var(--create-hover-to)
      );
    }
  }

  .brand-logo {
    background: linear-gradient(to bottom, var(--brand-from), var(--brand-to));
  }
}

/* Mobile terminal control keys */
.terminal-key {
  -webkit-tap-highlight-color: transparent;
  touch-action: none;
  user-select: none;
}

/* DPad/NumPad need touch-action: none for custom gesture handling */
.terminal-key-gesture {
  -webkit-tap-highlight-color: transparent;
  touch-action: none;
  user-select: none;
}

.xterm {
  width: 100%;
  height: 100%;
  box-sizing: border-box;
  padding: 0;
}

.xterm .xterm-viewport {
  background-color: transparent;
  scrollbar-width: thin;
  -webkit-overflow-scrolling: touch;
  overscroll-behavior: contain;
}

@media (max-width: 767px) {
  .xterm,
  .xterm .xterm-viewport {
    touch-action: none;
    overscroll-behavior: none;
    -webkit-touch-callout: none;
  }
}

/* iOS root positioning for visual viewport tracking */
@media (max-width: 767px) {
  .viewport-tracked #root {
    width: var(--visual-viewport-width, 100vw);
    height: var(--visual-viewport-height, 100dvh);
  }

  .ios.viewport-tracked #root {
    position: fixed;
    top: 0;
    left: 0;
    width: var(--visual-viewport-width, 100vw);
    height: var(--visual-viewport-height, 100dvh);
    transform: translate3d(
      var(--viewport-offset-left, 0px),
      var(--viewport-offset-top, 0px),
      0
    );
    transform-origin: top left;
  }
}

/* Safe area padding when keyboard is hidden */
.ios.viewport-tracked:not(.keyboard-visible) #root {
  padding-bottom: env(safe-area-inset-bottom, 0px);
}

/* Sidebar drawer backdrop */
@media (max-width: 767px) {
  .sidebar-drawer-backdrop {
    position: fixed;
    inset: 0;
    z-index: 40;
    background: rgba(0, 0, 0, 0.5);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s ease-out;
  }

  .sidebar-drawer-backdrop.open {
    opacity: 1;
    pointer-events: auto;
  }
}

/* Prevent iOS zoom on inputs */
@media (max-width: 767px) {
  input,
  select,
  textarea {
    font-size: 16px !important;
  }
}

/* Sheet slide animations */
@keyframes slide-in-from-right {
  from {
    transform: translateX(100%);
  }
}

@keyframes slide-out-to-right {
  to {
    transform: translateX(100%);
  }
}

/* Reduced motion */
@media (prefers-reduced-motion: reduce) {
  *,
  *::before,
  *::after {
    animation-duration: 0.01ms !important;
    animation-iteration-count: 1 !important;
    transition-duration: 0.01ms !important;
  }
}
