# Services

![Desktop services](assets/images/desktop-services.png)

Dedicated service management page at `/services`, part of the [Ops Control Plane](/features/ops-control-plane.md). Sentinel monitors and controls host services via systemd (Linux) and launchd (macOS).

## Tracked Services

Sentinel tracks two built-in services automatically:

- `sentinel` — the Sentinel server process
- `sentinel-updater` — the autoupdate timer

Custom services can be registered via API or the UI to add them to the tracked set.

## Service Browse

Browse discovers all user-scope service units on the host and annotates them with tracking status.

`GET /api/ops/services/browse` returns a list where each entry contains:

- `unit` — systemd unit name or launchd label
- `description` — human-readable service description
- `activeState` — current runtime state (active, inactive, failed, etc.)
- `enabledState` — whether the unit is enabled
- `manager` — `systemd` or `launchd`
- `scope` — `user` or `system`
- `tracked` — whether this unit is in the tracked set
- `trackedName` — the registered name, if tracked

From the browse view, any service can be started, stopped, restarted, inspected, or have its logs viewed without needing to track it first.

## Custom Services

Register a custom service to include it in the tracked set:

```
POST /api/ops/services
```

```json
{
  "name": "my-service",
  "displayName": "My Service",
  "manager": "systemd",
  "unit": "my-service.service",
  "scope": "user"
}
```

Defaults: `manager` defaults to `systemd`, `scope` defaults to `user`, `displayName` defaults to `name`.

Stored in the `ops_custom_services` table.

Remove a tracked custom service:

```
DELETE /api/ops/services/{service}
```

## Unit-Level Controls

Direct actions on any unit by reference, without requiring it to be tracked:

**Action** — start, stop, or restart a unit:

```
POST /api/ops/services/unit/action
```

```json
{
  "unit": "my-service.service",
  "scope": "user",
  "manager": "systemd",
  "action": "start"
}
```

**Status inspect**:

```
GET /api/ops/services/unit/status?unit=my-service.service&scope=user&manager=systemd
```

**Logs**:

```
GET /api/ops/services/unit/logs?unit=my-service.service&scope=user&manager=systemd&lines=200
```

## Named Service Actions

For tracked services, use the name-based endpoints:

```
POST /api/ops/services/{service}/action
```

```json
{ "action": "restart" }
```

Supported actions: `start`, `stop`, `restart`.

**Status inspect**:

```
GET /api/ops/services/{service}/status
```

Returns service properties, summary, raw output, and a checked-at timestamp.

**Logs**:

```
GET /api/ops/services/{service}/logs?lines=50
```

## Realtime Events

Service state changes emit events over the `/ws/events` WebSocket:

- `ops.services.updated` — full service list refresh
- `ops.overview.updated` — updated overview with service health summary
- `ops.alerts.updated` — alerts generated by failed actions
- `ops.activity.updated` — timeline entries for service actions

## UX Behavior

- Service actions use optimistic updates. The UI reflects the expected state immediately and reconciles when the server responds or a realtime event arrives.
- Failed actions roll back the optimistic state and generate a toast notification.
- Every service action creates a timeline entry.
- The browse view supports filtering by state (active, inactive, failed), scope (user, system), and free-text search.
- Services can be pinned (tracked) or unpinned directly from the browse list.

## Frontend

The dedicated `/services` route provides a full-page service management experience.

- The sidebar (`ServicesSidebar`) lists pinned/tracked services with live status indicators. A `?` help dialog button and token/lock controls are available at the top of the sidebar.
- The main panel has a stats header showing total, active, and failed service counts, followed by a browse panel.
- The browse panel discovers all host services and supports filtering by state (active/inactive/failed), scope (user/system), and free-text search.
- Per-service actions include start, stop, restart, status inspect, and logs view. Services can be pinned or unpinned directly from the browse list.
- Service status and logs open in modal dialogs.
- Real-time updates arrive via WebSocket events (`ops.services.updated`, `ops.overview.updated`), keeping the sidebar and browse panel in sync without polling.

## API Endpoints

- `GET /api/ops/services`
- `GET /api/ops/services/browse`
- `GET /api/ops/services/discover`
- `POST /api/ops/services`
- `DELETE /api/ops/services/{service}`
- `POST /api/ops/services/{service}/action`
- `GET /api/ops/services/{service}/status`
- `GET /api/ops/services/{service}/logs`
- `POST /api/ops/services/unit/action`
- `GET /api/ops/services/unit/status`
- `GET /api/ops/services/unit/logs`
